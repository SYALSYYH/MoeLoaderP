<UserControl
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:controlParts="clr-namespace:MoeLoaderP.Wpf.ControlParts"
    x:Class="MoeLoaderP.Wpf.ControlParts.SettingsControl"
    mc:Ignorable="d" 
    d:DesignHeight="611.286" d:DesignWidth="380.882" Width="310" Height="560" >
    <ScrollViewer Template="{DynamicResource MoeScrollViewerControlTemplate}">
        <StackPanel>
            <GroupBox
                Header="{DynamicResource TextSettingsProxyGroup}" Template="{DynamicResource MoeGroupBoxControlTemplate}" Margin="0,2">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <ComboBox x:Name="ProxyModeComboBox" Margin="4" SelectedIndex="{Binding ProxyMode, Converter={StaticResource ProxyModeToSelectIndexConverter}, Mode=TwoWay}" Height="24" Template="{DynamicResource MoeSitesComboBoxControlTemplate}" 
                        ItemContainerStyle="{DynamicResource MoeNormalComboBoxItemStyle}">
                        <ComboBoxItem Content="{DynamicResource TextSettingsProxyModeNone}" />
                        <ComboBoxItem Content="{DynamicResource TextSettingsProxyModeCustom}" />
                        <ComboBoxItem Content="IE浏览器设置"/>
                    </ComboBox>
                    <TextBox
                        x:Name="CustomProxyTextBox"
                        Width="138"
                        HorizontalAlignment="Left"
                        VerticalAlignment="Top"
                        Text="127.0.0.1:1080"
                        TextWrapping="NoWrap" Template="{DynamicResource MoeSingleLineTextBoxControlTemplate}" Grid.Column="1" Margin="4" Height="24" />
                </Grid>
            </GroupBox>

            <GroupBox Header="{DynamicResource TextSettingsGroupSearch}" Template="{DynamicResource MoeGroupBoxControlTemplate}" Margin="0,2">
                <StackPanel Margin="4">
                    <Grid Height="66.24">
                        <Grid.RowDefinitions>
                            <RowDefinition/>
                            <RowDefinition/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="56*"/>
                            <ColumnDefinition Width="81*"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock TextWrapping="Wrap" VerticalAlignment="Center" Height="15.24" Margin="0,10,0,7.88" Text="{DynamicResource TextSettingsParallelLoadMaxCount}"/>
                        <controlParts:VariableCountControl x:Name="ImageParallelLoadMaxCountBox" Grid.Column="1" MinCount="5" MaxCount="20" NumCount="{Binding MaxOnLoadingImageCount, Mode=TwoWay}" Width="150" Height="24"/>
                        <TextBlock TextWrapping="Wrap" Text="{DynamicResource TextSettingsHistoryMaxCount}" VerticalAlignment="Center" Height="15.24" Margin="0,7.228,0,10.652" Grid.Row="1"/>
                        <controlParts:VariableCountControl x:Name="HistoryMaxCountBox" Grid.Column="1" MinCount="5" MaxCount="30" NumCount="{Binding HistoryKeywordsMaxCount, Mode=TwoWay}" Grid.Row="1" Width="150" Height="24"/>
                    </Grid>
                    <Button x:Name="ClearHistoryButton" Content="{DynamicResource TextSettingsClearHistory}" Template="{DynamicResource MoeButtonControlTemplate}" Height="24" Margin="0,4,0,0"/>
                    <CheckBox x:Name="ClearImgsWhenSerachNextPageCheckBox" Content="搜索下一页时清除当前页图片" IsChecked="{Binding IsClearImgsWhenSerachNextPage}" Margin="0,6,0,0"/>
                </StackPanel>
            </GroupBox>

            <GroupBox
                Header="{DynamicResource TextSettingsDownloadGroup}" Template="{DynamicResource MoeGroupBoxControlTemplate}" Margin="0,2">
                <StackPanel Margin="4">
                    <Grid Height="24">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="50*"/>
                            <ColumnDefinition Width="75*"/>
                        </Grid.ColumnDefinitions>
                        <controlParts:VariableCountControl x:Name="ParallelDownloadingMaxCountBox" MinCount="1" MaxCount="15" NumCount="{Binding MaxOnDownloadingImageCount, Mode=TwoWay}" Grid.Column="1" Width="150" Height="24"/>
                        <TextBlock TextWrapping="Wrap" Text="{DynamicResource TextSettingsDownloadParallelDownloadingCount}" VerticalAlignment="Center"/>
                    </Grid>
                    <Grid Height="25" Margin="0,2,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="259.112"/>
                        </Grid.ColumnDefinitions>
                        <CheckBox x:Name="DownladFirstSeveralCheckBox" IsChecked="{Binding IsDownladFirstSeveral}" VerticalAlignment="Center" Height="15.1">
                            <TextBlock><Run Text="下载图组时只下载前"/><Run Text=" "/><Run Text="{Binding NumCount, ElementName=DownladFirstSeveralCountBox, Mode=OneWay}"/><Run Text=" "/><Run Text="张"/></TextBlock>
                        </CheckBox>
                        <controlParts:VariableCountControl x:Name="DownladFirstSeveralCountBox" MinCount="1" MaxCount="99" NumCount="{Binding DownladFirstSeveralCount, Mode=TwoWay}" VerticalAlignment="Center" Height="22" HorizontalAlignment="Right" Width="82" IsEnabled="{Binding IsChecked, ElementName=DownladFirstSeveralCheckBox}"/>
                    </Grid>
                    <TextBlock
                        HorizontalAlignment="Left"
                        VerticalAlignment="Top" Margin="0,4"><Run Text="存储文件夹位置（分站点"/><Run Text="文件夹"/><Run Text="保存）"/></TextBlock>
                    <Grid Margin="0,0,0,4">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="215*"/>
                            <ColumnDefinition Width="47*"/>
                        </Grid.ColumnDefinitions>
                        <TextBox
                            x:Name="ImageSaveDirectionTextBox"
                            Text="{Binding ImageSavePath, Converter={StaticResource ImageSavePathNullConvertor}, Mode=OneWay}"
                            Height="26"
                            Margin="0,0,3.029,0"
                            VerticalAlignment="Top"
                            TextWrapping="NoWrap" Template="{DynamicResource MoeSingleLineTextBoxControlTemplate}" IsReadOnly="True" />
                        <Button x:Name="SaveFolderBrowseButton"
                            Width="45.362"
                            Height="26"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Top"
                            Content="{DynamicResource TextCommonBrowse}" Template="{DynamicResource MoeButtonControlTemplate}" Grid.Column="1" />
                    </Grid>
                    <CheckBox x:Name="SortFolderByKeywordCheckBox" Content="按搜索关键字分文件夹保存" IsChecked="{Binding IsSortFolderByKeyword}" Margin="0,4,0,0"/>
                    <StackPanel Orientation="Vertical">
                        <CheckBox x:Name="CustomNameFormatCheckBox" Content="自定义文件命名格式（不带扩展名）" IsChecked="{Binding IsUseCustomFileNameFormat}" Margin="0,4,0,0"/>
                        <TextBox
                            x:Name="FileNameFormatTextBox"
                            VerticalAlignment="Top"
                            Text="{Binding SaveFileNameFormat}"
                            TextWrapping="NoWrap" Template="{DynamicResource MoeSingleLineTextBoxControlTemplate}" Height="26" IsEnabled="{Binding IsChecked, ElementName=CustomNameFormatCheckBox}" Margin="0,4,0,0" />
                        <WrapPanel x:Name="NameFormatPanel" Orientation="Horizontal" IsEnabled="{Binding IsChecked, ElementName=CustomNameFormatCheckBox}" Margin="0,4,0,0">
                            <Button
                                x:Name="NameFormatSiteButton"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Bottom"
                                Content="%site"
                                ToolTip="站点" Template="{DynamicResource MoeButtonControlTemplate}" Height="24" Width="46.444" Margin="2" />
                            <Button
                                x:Name="NameFormatIdButton"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Bottom"
                                Content="%id"
                                ToolTip="作品ID" Template="{DynamicResource MoeButtonControlTemplate}" Height="24" Width="33.111" Margin="2" />
                            <Button
                                x:Name="NameFormatTagButton"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Bottom"
                                Content="%tag"
                                ToolTip="作品标签" Template="{DynamicResource MoeButtonControlTemplate}" Height="24" Width="41.556" Margin="2" />
                            <Button
                                x:Name="NameFormatDiescButton"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Bottom"
                                Content="%title"
                                ToolTip="作品标题" Template="{DynamicResource MoeButtonControlTemplate}" Height="24" Width="47.111" Margin="2" />
                            <Button
                                x:Name="NameFormatAuthorButton"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Bottom"
                                Content="%uploader"
                                ToolTip="上传者名" Template="{DynamicResource MoeButtonControlTemplate}" Height="24" Width="78" Margin="2" />
                            <Button
                                x:Name="NameFormatDateButton"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Bottom"
                                Content="%date"
                                ToolTip="上载时间" Template="{DynamicResource MoeButtonControlTemplate}" Height="24" Width="49.556" Margin="2" />
                            <Button
                                x:Name="NameFormatOriginButton"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Bottom"
                                Content="%origin"
                                ToolTip="原始文件名" Template="{DynamicResource MoeButtonControlTemplate}" Height="24" Width="53" Margin="2" />
                            <Button
                                HorizontalAlignment="Left"
                                VerticalAlignment="Bottom"
                                Content="%copyright"
                                ToolTip="作品名" Template="{DynamicResource MoeButtonControlTemplate}" Height="24" Width="73" Margin="2" />
                            <Button
                                HorizontalAlignment="Left"
                                VerticalAlignment="Bottom"
                                Content="%character"
                                ToolTip="角色名" Template="{DynamicResource MoeButtonControlTemplate}" Height="24" Width="78" Margin="2" />
                            <Button
                                HorizontalAlignment="Left"
                                VerticalAlignment="Bottom"
                                Content="%artist"
                                ToolTip="画师名" Template="{DynamicResource MoeButtonControlTemplate}" Height="24" Width="57" Margin="2" />
                        </WrapPanel>
                        <CheckBox x:Name="AutoRenameCheckBox" Content="文件名相同时自动重命名（否则直接跳过）" IsChecked="{Binding IsAutoRenameWhenSame}" Margin="0,4,0,0"/>
                    </StackPanel>
                </StackPanel>
            </GroupBox>
            <GroupBox Template="{DynamicResource MoeGroupBoxControlTemplate}" Margin="0,2" Header="软件设置">
                <StackPanel Margin="4">
                    <CheckBox x:Name="IsShowBgImage" Content="显示软件背景图片" IsChecked="{Binding IsShowBgImage}" Margin="0,4,0,0"/>
                </StackPanel>
            </GroupBox>

        </StackPanel>
    </ScrollViewer>
</UserControl>
